#  数据库面试真题

##  一、什么是事务？

###  1.概念

* 数据库事务是访问并可能操作各种数据项的的一个数据库操作序列， 这些操作要么全部执行， 要么全部不执行， 是一个不可分割的工作单位。事务是由事务开始和事务结束之间执行的全部数据库操作组成。
* 事务是工作的离散单位， 他本质上是对于数据库进行的一系列修改， 暂时不写入数据库， 而是缓存起来， 用户在自己的终端可以预览变化， 直至全部修改完成， 并经过检查确认无误后， 一次性提交并写入数据库， 在提交之前， 必要的话所做的修改都可以取消。提交之后， 就不能撤销， 提交成功后其他用户才可以通过查询浏览数据的变化。

###  2.性质

* 原子性：事务中的全部操作在数据库中是不可以分割的， 要么全部完成， 要么全部不执行。
* 一致性：几个并行执行的事务， 其执行结果必须是按照某一顺序， 串行执行的结果相一致。
* 夺隔离性：事务的执行不受其他事务的干扰， 事务执行的中间结果对于其他事物必须是透明的。
* 夺持久性：对于任意已经提交的事务， 系统必须保证该事务队数据库的改变不被丢失， 即使数据库出现故障。
* 事务的ACID特性是由关系数据库系统(DBMS)来实现的，DBMS采用日志来保证事务的原子性、一致性和持久性。日志记录了事务对数据库所作的更新，如果某个事务在执行过程中发生错误，就可以根据日志撤销事务对数据库已做的更新，使得数据库同滚到执行事务前的初始状态。
  对于事务的隔离性，DBMS是采用锁机制来实现的。当多个事务同时更新数据库中相同的数据时，只允许持有锁的事务能更新该数据，其他事务必须等待，直到前一个事务释放了锁，其他事务才有机会更新 

###  3.作用

* 为数据库操作序列提供了一个从失败恢复到正常状态的方法， 同时提供了数据库即使在异常情况下仍能报纸一致性的方法。
* 当多个应用程序在并发访问数据库时， 可以在这些应用之间提供一个隔离方法， 以防止彼此的操作相互干扰。

###  4.数据库事务模型

* 显式事务：又称为自定义事务， 是指用显式的方式定义开始和结束的事务， 当使用start transaction和 commit语句时则表示发生显式事务。
* 隐式事务：是指每一条数据操作语句都自动地成为一个事务，事务的开始是隐式的，事务的结束有明确的标记。即当用户进行数据操作时，系统自动开启一个事务，事务的结束则需手动调用 commit或 rollback语句来结束当前事务，在当前事务结束后又自动开启一个新事务
* 自动事务：自动事务是指能够自动开启事务并且能够自动结束事务。在事务执行过程中，如果没有出现异常，事务则自动提交;当执行过程产生错误时，则事务自动回滚。

###  5.优点

* 把逻辑相关的操作分成一个组
* 在数据永久进行改变时， 可以预览数据变化
* 能够保证数据的读一致性

##  二、内连接和外连接有什么区别

数据库的内连接和外连接有啥区别?

###  1.样例

* A表                B表

  id      name            id      name
  1          a                1       b
  2          b                3       c
  4          c

  内连接就是左表和右表相同的数据：
  select * from A inner join B on A.id=B.id
  id      name            id      name
  1          a                1       b

  外连接分为：左外连接、右外连接、全外连接

  左外连接就是以左表为准，去匹配右表，左表有多少条数据，结果就是多少条数据
  select * from A left join B on A.id=B.id
  id      name            id     name
  1          a                1       b
  2          b                null      null
  4          c                null      null
  右外连接就是与左外连接反之，以右表为准，去匹配左表，右表有多少条数据，结果就是多少条数据
  select * from A right join B on A.id=B.id
  id      name            id     name
  1          a                1       b
  null        null               3       c
  全外连接数据条数不一定，相当与是左外连接和右外连接的综合
  select * from A full join B on A.id=B.id
  id      name            id      name
  1          a                1       b
  2          b                null      null
  null       null               3       c
  4          c                 null       null

 

###  2.数据库内连接外连接区别

（一）内连接
  内连接查询操作列出与连接条件匹配的数据行，它使用比较[运算符](http://zhidao.baidu.com/search?word=%E8%BF%90%E7%AE%97%E7%AC%A6&fr=qb_search_exp&ie=utf8)比较被连接列的列值。

内连接分三种：
  1、等值连接：在连接条件中使用等于号(=)[运算符](http://zhidao.baidu.com/search?word=%E8%BF%90%E7%AE%97%E7%AC%A6&fr=qb_search_exp&ie=utf8)比较被连接列的列值，其查询结果中列出被连接表中的所有列，包括其中的重复列。
  例，下面使用等值连接列出authors和publishers表中位于同一城市的作者和出版社：
  SELECT *
  FROM authors AS a [INNER JOIN](http://zhidao.baidu.com/search?word=INNER%20JOIN&fr=qb_search_exp&ie=utf8) publishers AS p
  ON a.city=p.city
  2、不等连接：在连接条件使用除等于[运算符](http://zhidao.baidu.com/search?word=%E8%BF%90%E7%AE%97%E7%AC%A6&fr=qb_search_exp&ie=utf8)以外的其它比较运算符比较被连接的
列的列值。这些运算符包括>、>=、<=、<、!>、!<和<>。
  3、自然连接：在连接条件中使用等于(=)运算符比较被连接列的列值，但它使用选择列表指出查询结果集合中所包括的列，并删除连接表中的重复列。
  例，在选择列表中删除authors 和publishers 表中重复列(city和state)：
  SELECTa.*,p.pub_id,p.pub_name,p.country
  FROM authors AS a [INNER JOIN](http://zhidao.baidu.com/search?word=INNER%20JOIN&fr=qb_search_exp&ie=utf8) publishers AS p
  ON a.city=p.city
(二) [外连接](http://zhidao.baidu.com/search?word=%E5%A4%96%E8%BF%9E%E6%8E%A5&fr=qb_search_exp&ie=utf8)  
  [外连接](http://zhidao.baidu.com/search?word=%E5%A4%96%E8%BF%9E%E6%8E%A5&fr=qb_search_exp&ie=utf8)，返回到查询结果集合中的不仅包含符合连接条件的行，而且还包括左表(左外连接或左连接))、右表(右外连接或右连接)或两个边接表(全外连接)中的所有数据行。
  left join(左联接) 返回包括左表中的所有记录和右表中联结字段相等的记录；
  right join(右联接) 返回包括右表中的所有记录和左表中联结字段相等的记录；
例如1：SELECT a.*,b.* FROM luntanLEFT JOIN usertable as b
   ON a.username=b.username
例如2：SELECT a.*,b.*
   FROM city as a FULL OUTER JOIN user asb
   ON a.username=b.username
(三) 交叉连接   
  交叉连接不带WHERE 子句，它返回被连接的两个表所有数据行的笛卡尔积，返回到
结果集合中的数据行数等于第一个表中符合查询条件的数据行数乘以第二个表中符合查
询条件的数据行数。例，titles表中有6类图书，而publishers表中有8家出版社，则下
列交叉连接检索到的记录数将等于6*8=48行。   
  例如：SELECT type,pub_name
   FROM titles CROSS JOIN publishers
   ORDER BY type

##  3. 存储过程和函数的区别

函数只能返回一个变量，而存储过程可以返回多个；

函数可以嵌入sql中和存储过程中使用，但是存储过程需要让sql的query可以执行，将mysql_real_connect的最后一个参数设置为CLIENT_MULTI_STATEMENTS

函数的限制比较多，不能用临时表，只能用表变量，有些函数不能用，存储过程限制少

存储过程处理的功能比较复杂，而函数实现的功能针对性强，

存储过程可以执行修改表的操作，但是函数不能执行一组修改全局数据库状态的操作

存储过程可以返回参数，如记录集，函数只能返回值或者表对象。存储过程的参数有in，out，inout三种，函数只有in，存储过程声明时不需要返回类型，而函数需要描述返回类型，且函数中必须包含一个有效的return语句

存储过程一般是作为独立部分来执行，而函数可以作为查询语句的一个部分来调用，由于函数可以返回一个表对象，所以在查询中位于from关键字后面，sql语句中不可以含有存储过程











